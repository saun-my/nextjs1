{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 88, "column": 0}, "map": {"version":3,"sources":["file:///Users/saunmy/Desktop/nextjs1/nextjs1/auth.ts"],"sourcesContent":["import NextAuth from 'next-auth';\nimport Credentials from 'next-auth/providers/credentials';\n\nexport const { auth, signIn, signOut, handlers } = NextAuth({\n  providers: [\n    Credentials({\n      name: 'credentials',\n      credentials: {\n        email: { label: 'Email', type: 'email' },\n        password: { label: 'Password', type: 'password' },\n      },\n      authorize: async (credentials) => {\n        const email = credentials?.email as string;\n        const password = credentials?.password as string;\n        // 动态导入 Node-only 依赖，避免被 Edge Runtime 打包\n        const { default: postgres } = await import('postgres');\n        const sql = postgres(process.env.POSTGRES_URL!, {\n          ssl: process.env.POSTGRES_SSL === 'require' ? 'require' : undefined,\n        });\n\n        const rows = await sql<{\n          id: string;\n          name: string;\n          email: string;\n          password: string;\n          is_vip: boolean;\n          roles: string | null;\n        }[]>`\n          SELECT\n            u.id, u.name, u.email, u.password, u.is_vip,\n            COALESCE(STRING_AGG(r.name, ','), '') AS roles\n          FROM users u\n          LEFT JOIN user_roles ur ON ur.user_id = u.id\n          LEFT JOIN roles r ON r.id = ur.role_id\n          WHERE u.email = ${email}\n          GROUP BY u.id\n          LIMIT 1\n        `;\n        const user = rows[0];\n        if (!user) return null;\n\n        // 跳过密码校验，直接允许该邮箱登录\n        return {\n          id: user.id,\n          name: user.name,\n          email: user.email,\n          isVip: user.is_vip,\n          roles: (user.roles ?? '').split(',').filter(Boolean),\n        };\n      },\n    }),\n  ],\n  secret: process.env.AUTH_SECRET,\n  session: { strategy: 'jwt' },\n  callbacks: {\n    async jwt({ token, user }) {\n      if (user) {\n        token.isVip = (user as any).isVip ?? false;\n        token.roles = (user as any).roles ?? [];\n      }\n      return token;\n    },\n    async session({ session, token }) {\n      session.user = {\n        ...session.user,\n        id: token.sub!,\n        roles: (token as any).roles ?? [],\n        isVip: (token as any).isVip ?? false,\n      } as any;\n      return session;\n    },\n  },\n  // 可按需自定义 cookies、pages 等\n});"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;AAAA;;;AAEO,MAAM,EAAE,IAAI,EAAE,MAAM,EAAE,OAAO,EAAE,QAAQ,EAAE,GAAG,IAAA,6KAAQ,EAAC;IAC1D,WAAW;QACT,IAAA,kLAAW,EAAC;YACV,MAAM;YACN,aAAa;gBACX,OAAO;oBAAE,OAAO;oBAAS,MAAM;gBAAQ;gBACvC,UAAU;oBAAE,OAAO;oBAAY,MAAM;gBAAW;YAClD;YACA,WAAW,OAAO;gBAChB,MAAM,QAAQ,aAAa;gBAC3B,MAAM,WAAW,aAAa;gBAC9B,wCAAwC;gBACxC,MAAM,EAAE,SAAS,QAAQ,EAAE,GAAG;gBAC9B,MAAM,MAAM,SAAS,QAAQ,GAAG,CAAC,YAAY,EAAG;oBAC9C,KAAK,QAAQ,GAAG,CAAC,YAAY,KAAK,YAAY,YAAY;gBAC5D;gBAEA,MAAM,OAAO,MAAM,GAOf,CAAC;;;;;;;0BAOa,EAAE,MAAM;;;QAG1B,CAAC;gBACD,MAAM,OAAO,IAAI,CAAC,EAAE;gBACpB,IAAI,CAAC,MAAM,OAAO;gBAElB,mBAAmB;gBACnB,OAAO;oBACL,IAAI,KAAK,EAAE;oBACX,MAAM,KAAK,IAAI;oBACf,OAAO,KAAK,KAAK;oBACjB,OAAO,KAAK,MAAM;oBAClB,OAAO,CAAC,KAAK,KAAK,IAAI,EAAE,EAAE,KAAK,CAAC,KAAK,MAAM,CAAC;gBAC9C;YACF;QACF;KACD;IACD,QAAQ,QAAQ,GAAG,CAAC,WAAW;IAC/B,SAAS;QAAE,UAAU;IAAM;IAC3B,WAAW;QACT,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAAE;YACvB,IAAI,MAAM;gBACR,MAAM,KAAK,GAAG,AAAC,KAAa,KAAK,IAAI;gBACrC,MAAM,KAAK,GAAG,AAAC,KAAa,KAAK,IAAI,EAAE;YACzC;YACA,OAAO;QACT;QACA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAE;YAC9B,QAAQ,IAAI,GAAG;gBACb,GAAG,QAAQ,IAAI;gBACf,IAAI,MAAM,GAAG;gBACb,OAAO,AAAC,MAAc,KAAK,IAAI,EAAE;gBACjC,OAAO,AAAC,MAAc,KAAK,IAAI;YACjC;YACA,OAAO;QACT;IACF;AAEF","debugId":null}},
    {"offset": {"line": 176, "column": 0}, "map": {"version":3,"sources":["file:///Users/saunmy/Desktop/nextjs1/nextjs1/app/api/auth/%5B...nextauth%5D/route.ts"],"sourcesContent":["import { handlers } from '@/auth';\nexport const { GET, POST } = handlers;\nexport const runtime = 'nodejs';"],"names":[],"mappings":";;;;;;;;AAAA;;AACO,MAAM,EAAE,GAAG,EAAE,IAAI,EAAE,GAAG,6HAAQ;AAC9B,MAAM,UAAU","debugId":null}}]
}