module.exports = [
"[externals]/next/dist/compiled/next-server/app-route-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-route-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/@opentelemetry/api [external] (next/dist/compiled/@opentelemetry/api, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/@opentelemetry/api", () => require("next/dist/compiled/@opentelemetry/api"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-page-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/shared/lib/no-fallback-error.external.js [external] (next/dist/shared/lib/no-fallback-error.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/shared/lib/no-fallback-error.external.js", () => require("next/dist/shared/lib/no-fallback-error.external.js"));

module.exports = mod;
}),
"[externals]/os [external] (os, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("os", () => require("os"));

module.exports = mod;
}),
"[externals]/fs [external] (fs, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("fs", () => require("fs"));

module.exports = mod;
}),
"[externals]/net [external] (net, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("net", () => require("net"));

module.exports = mod;
}),
"[externals]/tls [external] (tls, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("tls", () => require("tls"));

module.exports = mod;
}),
"[externals]/crypto [external] (crypto, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("crypto", () => require("crypto"));

module.exports = mod;
}),
"[externals]/stream [external] (stream, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("stream", () => require("stream"));

module.exports = mod;
}),
"[externals]/perf_hooks [external] (perf_hooks, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("perf_hooks", () => require("perf_hooks"));

module.exports = mod;
}),
"[project]/nextjs1/app/api/learning/recommendations/route.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

/* __next_internal_action_entry_do_not_use__ [{"4018837331ab19271bc70582110c3bda48f8d74db2":"GET"},"",""] */ __turbopack_context__.s([
    "GET",
    ()=>GET
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$nextjs1$2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$0$2e$2_react$2d$dom$40$19$2e$2$2e$0_react$40$19$2e$2$2e$0_$5f$react$40$19$2e$2$2e$0$2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/nextjs1/node_modules/.pnpm/next@16.0.2_react-dom@19.2.0_react@19.2.0__react@19.2.0/node_modules/next/dist/build/webpack/loaders/next-flight-loader/server-reference.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$nextjs1$2f$node_modules$2f2e$pnpm$2f$postgres$40$3$2e$4$2e$7$2f$node_modules$2f$postgres$2f$src$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/nextjs1/node_modules/.pnpm/postgres@3.4.7/node_modules/postgres/src/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$nextjs1$2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$0$2e$2_react$2d$dom$40$19$2e$2$2e$0_react$40$19$2e$2$2e$0_$5f$react$40$19$2e$2$2e$0$2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$validate$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/nextjs1/node_modules/.pnpm/next@16.0.2_react-dom@19.2.0_react@19.2.0__react@19.2.0/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-validate.js [app-route] (ecmascript)");
;
;
const sql = (0, __TURBOPACK__imported__module__$5b$project$5d2f$nextjs1$2f$node_modules$2f2e$pnpm$2f$postgres$40$3$2e$4$2e$7$2f$node_modules$2f$postgres$2f$src$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(process.env.POSTGRES_URL, {
    ssl: process.env.POSTGRES_SSL === 'require' ? 'require' : undefined
});
async function GET(req) {
    try {
        const { searchParams } = new URL(req.url);
        const userId = searchParams.get('userId') || '';
        const limitParam = searchParams.get('limit');
        const limit = limitParam ? Math.max(1, Math.min(20, Number(limitParam))) : 6;
        const courses = await sql`
      SELECT id, title, level, description, cover_url, lessons_count, estimated_hours, difficulty_score, tags
      FROM courses
    `;
        let profile = null;
        if (userId) {
            const rows = await sql`
        SELECT user_id, preferred_difficulty, preferred_topics, learning_style, weekly_goal_hours, study_time_preference
        FROM user_learning_profiles WHERE user_id = ${userId}
      `;
            profile = rows[0] || null;
        }
        const progressRows = userId ? await sql`
          SELECT course_id, completed_lessons, total_score, time_spent_minutes, completion_percentage, is_completed
          FROM user_course_progress WHERE user_id = ${userId}
        ` : [];
        const progressByCourse = new Map();
        for (const p of progressRows)progressByCourse.set(p.course_id, p);
        const preferredDifficulty = profile?.preferred_difficulty ?? 5;
        const preferredTopics = profile?.preferred_topics ?? [];
        const learningStyle = profile?.learning_style ?? 'interactive';
        const recommendations = courses.map((c)=>{
            let score = 50;
            const diffMatch = 10 - Math.abs((c.difficulty_score ?? 5) - preferredDifficulty);
            score += diffMatch * 2;
            const tags = c.tags ?? [];
            const topicMatches = tags.filter((t)=>preferredTopics.includes(t)).length;
            score += topicMatches * 5;
            if (learningStyle === 'interactive' && c.level === 'Beginner') score += 10;
            const prog = progressByCourse.get(c.id);
            if (prog) {
                if (prog.is_completed) score = 0;
                else score += 20;
            }
            score = Math.min(100, Math.max(0, Math.round(score)));
            const confidence = Math.min(100, Math.max(70, score));
            return {
                course: {
                    id: c.id,
                    title: c.title,
                    description: c.description,
                    category: tags[0] || 'General',
                    difficulty: c.level === 'Beginner' ? 'beginner' : c.level === 'Intermediate' ? 'intermediate' : 'advanced',
                    estimatedHours: c.estimated_hours,
                    prerequisites: [],
                    tags,
                    learningObjectives: [],
                    modules: [],
                    rating: 4.6,
                    enrollmentCount: 1000,
                    completionRate: 0.7,
                    lastUpdated: new Date()
                },
                score,
                reasons: buildReasons(c, preferredTopics, prog),
                confidence: confidence / 100,
                estimatedCompletionTime: c.estimated_hours * 60,
                skillGapAnalysis: []
            };
        }).filter((r)=>r.score > 0).sort((a, b)=>b.score - a.score).slice(0, limit);
        return Response.json({
            recommendations,
            totalCount: recommendations.length,
            queryTime: 1,
            hasMore: false
        });
    } catch (error) {
        return Response.json({
            error: error.message
        }, {
            status: 500
        });
    }
}
function buildReasons(c, preferredTopics, prog) {
    const reasons = [];
    const tags = c.tags ?? [];
    const match = tags.filter((t)=>preferredTopics.includes(t));
    if (match.length) reasons.push(`匹配你的兴趣：${match.join('、')}`);
    if (c.level === 'Beginner') reasons.push('适合初学者逐步提升');
    if (prog && !prog.is_completed) reasons.push('继续你已开始但未完成的课程类别');
    return reasons.length ? reasons : [
        '综合匹配度较高'
    ];
}
;
(0, __TURBOPACK__imported__module__$5b$project$5d2f$nextjs1$2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$0$2e$2_react$2d$dom$40$19$2e$2$2e$0_react$40$19$2e$2$2e$0_$5f$react$40$19$2e$2$2e$0$2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$validate$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ensureServerEntryExports"])([
    GET
]);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$nextjs1$2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$0$2e$2_react$2d$dom$40$19$2e$2$2e$0_react$40$19$2e$2$2e$0_$5f$react$40$19$2e$2$2e$0$2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["registerServerReference"])(GET, "4018837331ab19271bc70582110c3bda48f8d74db2", null);
}),
];

//# sourceMappingURL=%5Broot-of-the-server%5D__01ef0df2._.js.map