{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///Users/saunmy/Desktop/nextjs1/nextjs1/app/api/investments/watchlist/route.ts"],"sourcesContent":["import { NextRequest } from 'next/server';\nimport postgres from 'postgres';\nimport { randomUUID } from 'crypto';\n\nconst sql = postgres(process.env.POSTGRES_URL_NON_POOLING || process.env.POSTGRES_URL!, {\n  ssl: 'require',\n  prepare: false,\n});\n\nasync function ensureSchema() {\n  await sql`\n    CREATE TABLE IF NOT EXISTS watchlist (\n      id UUID PRIMARY KEY,\n      user_id UUID REFERENCES users(id) ON DELETE CASCADE,\n      fund_code TEXT NOT NULL,\n      note TEXT,\n      created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),\n      UNIQUE (user_id, fund_code)\n    );\n  `;\n}\n\nexport async function GET(req: NextRequest) {\n  await ensureSchema();\n  const { searchParams } = new URL(req.url);\n  const userId = searchParams.get('userId');\n  const rows = userId\n    ? await sql`SELECT * FROM watchlist WHERE user_id=${userId} ORDER BY created_at DESC`\n    : await sql`SELECT * FROM watchlist ORDER BY created_at DESC LIMIT 100`;\n  return Response.json(rows);\n}\n\nexport async function POST(req: NextRequest) {\n  await ensureSchema();\n  const body = await req.json();\n  const { user_id, fund_code, note } = body;\n  if (!user_id || !fund_code) return Response.json({ error: 'missing fields' }, { status: 400 });\n  try {\n    await sql`\n      INSERT INTO watchlist (id, user_id, fund_code, note)\n      VALUES (${randomUUID()}, ${user_id}, ${fund_code}, ${note ?? null})\n      ON CONFLICT (user_id, fund_code) DO NOTHING\n    `;\n    return Response.json({ ok: true });\n  } catch (e) {\n    return Response.json({ error: (e as Error).message }, { status: 500 });\n  }\n}\n\nexport async function DELETE(req: NextRequest) {\n  await ensureSchema();\n  const { searchParams } = new URL(req.url);\n  const id = searchParams.get('id');\n  if (!id) return Response.json({ error: 'missing id' }, { status: 400 });\n  await sql`DELETE FROM watchlist WHERE id=${id}`;\n  return Response.json({ ok: true });\n}\n\n"],"names":[],"mappings":";;;;;;;;AACA;AACA;;;AAEA,MAAM,MAAM,IAAA,qNAAQ,EAAC,QAAQ,GAAG,CAAC,wBAAwB,IAAI,QAAQ,GAAG,CAAC,YAAY,EAAG;IACtF,KAAK;IACL,SAAS;AACX;AAEA,eAAe;IACb,MAAM,GAAG,CAAC;;;;;;;;;EASV,CAAC;AACH;AAEO,eAAe,IAAI,GAAgB;IACxC,MAAM;IACN,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,IAAI,GAAG;IACxC,MAAM,SAAS,aAAa,GAAG,CAAC;IAChC,MAAM,OAAO,SACT,MAAM,GAAG,CAAC,sCAAsC,EAAE,OAAO,yBAAyB,CAAC,GACnF,MAAM,GAAG,CAAC,0DAA0D,CAAC;IACzE,OAAO,SAAS,IAAI,CAAC;AACvB;AAEO,eAAe,KAAK,GAAgB;IACzC,MAAM;IACN,MAAM,OAAO,MAAM,IAAI,IAAI;IAC3B,MAAM,EAAE,OAAO,EAAE,SAAS,EAAE,IAAI,EAAE,GAAG;IACrC,IAAI,CAAC,WAAW,CAAC,WAAW,OAAO,SAAS,IAAI,CAAC;QAAE,OAAO;IAAiB,GAAG;QAAE,QAAQ;IAAI;IAC5F,IAAI;QACF,MAAM,GAAG,CAAC;;cAEA,EAAE,IAAA,mHAAU,IAAG,EAAE,EAAE,QAAQ,EAAE,EAAE,UAAU,EAAE,EAAE,QAAQ,KAAK;;IAEpE,CAAC;QACD,OAAO,SAAS,IAAI,CAAC;YAAE,IAAI;QAAK;IAClC,EAAE,OAAO,GAAG;QACV,OAAO,SAAS,IAAI,CAAC;YAAE,OAAO,AAAC,EAAY,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACtE;AACF;AAEO,eAAe,OAAO,GAAgB;IAC3C,MAAM;IACN,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,IAAI,GAAG;IACxC,MAAM,KAAK,aAAa,GAAG,CAAC;IAC5B,IAAI,CAAC,IAAI,OAAO,SAAS,IAAI,CAAC;QAAE,OAAO;IAAa,GAAG;QAAE,QAAQ;IAAI;IACrE,MAAM,GAAG,CAAC,+BAA+B,EAAE,GAAG,CAAC;IAC/C,OAAO,SAAS,IAAI,CAAC;QAAE,IAAI;IAAK;AAClC","debugId":null}}]
}