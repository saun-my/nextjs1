{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///Users/saunmy/Desktop/nextjs1/nextjs1/app/api/investments/route.ts"],"sourcesContent":[" \n\nimport { NextRequest } from 'next/server';\nimport { randomUUID } from 'crypto';\nimport postgres from 'postgres';\n\n\n\nconst sql = postgres(process.env.POSTGRES_URL || process.env.POSTGRES_URL_NON_POOLING!, {\n  ssl: process.env.POSTGRES_SSL === 'require' ? 'require' : undefined,\n});\n\nexport async function GET(req: NextRequest) {\n  try {\n    const { searchParams } = new URL(req.url);\n    const userId = searchParams.get('userId');\n    const rows = userId\n      ? await sql`SELECT * FROM investments WHERE user_id = ${userId} ORDER BY trade_date DESC, id DESC`\n      : await sql`SELECT * FROM investments ORDER BY trade_date DESC, id DESC LIMIT 100`;\n    return Response.json(rows);\n  } catch (e) {\n    return Response.json({ error: (e as Error).message }, { status: 500 });\n  }\n}\n\nexport async function POST(req: NextRequest) {\n  try {\n    const body = await req.json();\n    const { user_id, fund_code, amount, price, trade_date, note, action } = body;\n    if (!user_id || !fund_code || !amount || !price || !trade_date) {\n      return Response.json({ error: 'missing fields' }, { status: 400 });\n    }\n    await sql`\n      INSERT INTO investments (id, user_id, fund_code, amount, price, trade_date, note, action)\n      VALUES (${randomUUID()}, ${user_id}, ${fund_code}, ${Number(amount)}, ${Number(price)}, ${new Date(trade_date)}, ${note ?? null}, ${action ?? 'buy'})\n    `;\n    return Response.json({ ok: true });\n  } catch (e) {\n    return Response.json({ error: (e as Error).message }, { status: 500 });\n  }\n}\n\nexport async function PATCH(req: NextRequest) {\n  try {\n    const body = await req.json();\n    const { id, amount, price, trade_date, note, action } = body;\n    if (!id) return Response.json({ error: 'missing id' }, { status: 400 });\n    await sql`\n      UPDATE investments\n      SET amount = COALESCE(${amount != null ? Number(amount) : null}, amount),\n          price = COALESCE(${price != null ? Number(price) : null}, price),\n          trade_date = COALESCE(${trade_date ? new Date(trade_date) : null}, trade_date),\n          note = COALESCE(${note ?? null}, note),\n          action = COALESCE(${action ?? null}, action)\n      WHERE id = ${id}\n    `;\n    return Response.json({ ok: true });\n  } catch (e) {\n    return Response.json({ error: (e as Error).message }, { status: 500 });\n  }\n}\n\nexport async function DELETE(req: NextRequest) {\n  try {\n    const { searchParams } = new URL(req.url);\n    const id = searchParams.get('id');\n    if (!id) return Response.json({ error: 'missing id' }, { status: 400 });\n    await sql`DELETE FROM investments WHERE id=${id}`;\n    return Response.json({ ok: true });\n  } catch (e) {\n    return Response.json({ error: (e as Error).message }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}